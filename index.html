<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>In tem - Cô Mập Fashion</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --bg: #ffffff;
      --surface: #ffffff;
      --surface-solid: #ffffff;
      --text: #0b1220;
      --text-muted: rgba(11, 18, 32, 0.62);
      --border: rgba(15, 23, 42, 0.1);
      --border-strong: rgba(15, 23, 42, 0.16);
      --accent: #111827;
      --danger: #e11d48;
      --success: #16a34a;
      --info: #0284c7;
      --radius: 26px;
      --radius-sm: 16px;
      --shadow-sm: 0 18px 60px rgba(15, 23, 42, 0.08);
      --shadow-md: 0 28px 90px rgba(15, 23, 42, 0.1);
      --ring: 0 0 0 4px rgba(17, 24, 39, 0.14);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 24px clamp(14px, 2.6vw, 40px);
    }

    body.global-busy::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(
        90deg,
        rgba(15, 23, 42, 0) 0%,
        rgba(15, 23, 42, 0.6) 35%,
        rgba(15, 23, 42, 0) 70%
      );
      background-size: 200% 100%;
      animation: shimmer 0.9s linear infinite;
      z-index: 9999;
      pointer-events: none;
    }

    ::selection {
      background: rgba(65, 70, 81, 0.12);
    }

    [hidden] {
      display: none !important;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.001ms !important;
        scroll-behavior: auto !important;
      }
    }

    h1,
    h2,
    h3 {
      margin: 0;
      font-weight: 600;
      color: var(--text);
    }

    p {
      margin: 0;
      color: var(--text-muted);
    }

    main {
      max-width: 1240px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 18px;
      border: 1px solid rgba(15, 23, 42, 0.08);
      box-shadow: 0 14px 50px rgba(15, 23, 42, 0.06);
    }

    .page-header {
      position: relative;
      padding: 6px 0 22px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: var(--text);
      text-decoration: none;
      user-select: none;
    }

    .brand-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--text);
      display: inline-block;
    }

    .topbar-nav {
    }

    .hero {
      text-align: center;
      padding: 64px 0 8px;
    }

    .hero-title {
      font-size: clamp(2.6rem, 6vw, 5rem);
      font-weight: 700;
      letter-spacing: -0.04em;
      line-height: 0.98;
      margin: 0;
    }

    .hero-subtitle {
      margin: 14px auto 0;
      max-width: 60ch;
      color: rgba(11, 18, 32, 0.68);
      font-size: 1.05rem;
    }

    .tab-nav {
      display: inline-flex;
      align-items: center;
      gap: 28px;
      background: transparent;
      border-radius: 0;
      padding: 0;
      border: none;
      box-shadow: none;
      width: fit-content;
      margin: 34px auto 0;
    }

    .tab-button {
      border: none;
      border-radius: 0;
      padding: 0 0 10px;
      font-size: 1.02rem;
      font-weight: 500;
      background: transparent;
      color: rgba(11, 18, 32, 0.74);
      cursor: pointer;
      transition: color 0.2s ease, opacity 0.2s ease;
      border-bottom: 1px solid transparent;
    }

    .tab-button:hover {
      color: rgba(11, 18, 32, 0.9);
    }

    .tab-button:focus-visible {
      outline: none;
      box-shadow: var(--ring);
    }

    .tab-nav .tab-button {
      width: auto;
      justify-content: center;
    }

    .tab-button[aria-selected="true"] {
      color: var(--text);
      border-bottom-color: rgba(11, 18, 32, 0.7);
    }

    .tab-panel {
      display: grid;
      grid-template-columns: 420px minmax(0, 1fr);
      gap: 26px;
      align-items: start;
    }

    .tab-panel:not([hidden]) {
      animation: fadeUp 420ms ease both;
    }

    .tab-panel[hidden] {
      display: none;
    }

    @media (max-width: 980px) {
      .tab-panel {
        grid-template-columns: 1fr;
      }

      .hero {
        padding-top: 44px;
      }
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }

    .input-grid.input-grid-vertical {
      grid-template-columns: 1fr;
    }

    label {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      display: block;
      margin-bottom: 5px;
    }

    input,
    select {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      padding: 12px 14px;
      font-size: 0.95rem;
      font-family: inherit;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      background-color: #fff;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: rgba(109, 40, 217, 0.55);
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: var(--ring);
    }

    input:hover,
    select:hover {
      border-color: var(--border-strong);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    th,
    td {
      padding: 10px 10px;
      border-bottom: 1px solid rgba(29, 27, 32, 0.07);
      text-align: left;
    }

    th {
      font-size: 0.8rem;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      text-transform: uppercase;
      background: rgba(29, 78, 216, 0.05);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody tr.has-error {
      background: rgba(220, 38, 38, 0.05);
    }

    tbody tr {
      animation: fadeUp 320ms ease both;
    }

    .table-wrapper {
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.85);
    }

    .empty-state {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .actions.single-action {
      justify-content: flex-end;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    button {
      font-family: inherit;
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 0.92rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s ease, background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    button:hover:not(:disabled) {
      box-shadow: none;
    }

    button:focus-visible {
      outline: none;
      box-shadow: var(--ring);
    }

    button.is-loading {
      position: relative;
      padding-right: 42px;
    }

    button.is-loading::after {
      content: '';
      position: absolute;
      right: 14px;
      top: 50%;
      width: 16px;
      height: 16px;
      margin-top: -8px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.55);
      border-top-color: rgba(255, 255, 255, 0);
      animation: spin 0.8s linear infinite;
    }

    .btn-outline.is-loading::after {
      border-color: rgba(15, 23, 42, 0.28);
      border-top-color: rgba(15, 23, 42, 0);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
    }

    .btn-outline {
      background: transparent;
      color: var(--text);
      border: 1px solid rgba(15, 23, 42, 0.22);
      box-shadow: none;
    }

    .status-line {
      margin-top: 10px;
      font-size: 0.88rem;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.75);
      color: var(--text);
      position: relative;
      overflow: hidden;
    }

    .status-line.flash {
      animation: fadeUp 260ms ease both;
    }

    .status-line.is-busy {
      background: linear-gradient(
        90deg,
        rgba(15, 23, 42, 0.04) 0%,
        rgba(15, 23, 42, 0.08) 45%,
        rgba(15, 23, 42, 0.04) 100%
      );
      background-size: 200% 100%;
      animation: shimmer 1.2s ease infinite;
    }

    .status-line.is-busy::after {
      content: '';
      position: absolute;
      right: 12px;
      top: 50%;
      width: 14px;
      height: 14px;
      margin-top: -7px;
      border-radius: 999px;
      border: 2px solid rgba(15, 23, 42, 0.16);
      border-top-color: rgba(15, 23, 42, 0);
      animation: spin 0.8s linear infinite;
    }

    .helper {
      margin: 10px 0 0;
      font-size: 0.9rem;
      color: rgba(11, 18, 32, 0.6);
      text-align: right;
    }

    .status-line.info {
      background: rgba(2, 132, 199, 0.08);
      border-color: rgba(2, 132, 199, 0.24);
      color: var(--info);
    }

    .status-line.success {
      background: rgba(15, 123, 58, 0.08);
      border-color: rgba(15, 123, 58, 0.25);
      color: var(--success);
    }

    .status-line.error {
      background: rgba(192, 57, 43, 0.08);
      border-color: rgba(192, 57, 43, 0.3);
      color: var(--danger);
    }

    .table-summary {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
      font-size: 0.88rem;
      margin-bottom: 8px;
      color: var(--text-muted);
    }

    .layout-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .layout-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    .hasize-form {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: flex-end;
    }

    .hasize-form > div {
      flex: 1;
      min-width: 220px;
    }

    .hasize-form button {
      flex: 0 0 auto;
      padding-inline: 22px;
    }

    .hasize-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }

    .hasize-card {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
      display: flex;
      gap: 12px;
      background: rgba(255, 255, 255, 0.85);
    }

    .hasize-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .hasize-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .hasize-meta span {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
    }

    .hasize-serial {
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .hasize-info {
      list-style: none;
      padding: 0;
      margin: 0;
      color: var(--text-muted);
      font-size: 0.88rem;
    }

    .hasize-info li + li {
      margin-top: 4px;
    }

    .hasize-qr {
      width: 132px;
      min-width: 132px;
      border-left: 1px dashed rgba(15, 23, 42, 0.12);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding-left: 12px;
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .hasize-qr img {
      width: 110px;
      height: 110px;
      object-fit: contain;
    }

    .hasize-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    [data-busy="true"] {
      position: relative;
    }

    [data-busy="true"]::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(2px);
      border-radius: inherit;
    }

    [data-busy="true"]::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      width: 18px;
      height: 18px;
      margin-left: -9px;
      margin-top: -9px;
      border-radius: 999px;
      border: 2px solid rgba(15, 23, 42, 0.18);
      border-top-color: rgba(15, 23, 42, 0);
      animation: spin 0.8s linear infinite;
      z-index: 1;
    }

    [data-busy="true"] > * {
      opacity: 0.55;
    }

    .skeleton-card {
      border-radius: var(--radius);
      border: 1px solid rgba(15, 23, 42, 0.08);
      min-height: 98px;
      background: linear-gradient(
        90deg,
        rgba(15, 23, 42, 0.04) 0%,
        rgba(15, 23, 42, 0.08) 40%,
        rgba(15, 23, 42, 0.04) 80%
      );
      background-size: 200% 100%;
      animation: shimmer 1.2s ease infinite;
    }


    .label-page {
      width: 105mm;
      max-width: 100%;
      height: 22mm;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      display: flex;
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.25);
      position: relative;
    }

    .label-page::after {
      content: attr(data-page);
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .label-cell {
      flex: 1;
      min-width: 35mm;
      max-width: calc(100% / 3);
      border-right: 1px dashed rgba(15, 23, 42, 0.15);
      display: flex;
      gap: 6px;
      padding: 2mm 2mm 2mm 2.5mm;
      align-items: center;
      height: 22mm;
    }

    .label-cell:last-child {
      border-right: none;
    }

    .label-cell.is-blank {
      background: repeating-linear-gradient(45deg, #f1f5f9 0, #f1f5f9 6px, #fff 6px, #fff 12px);
      justify-content: center;
      font-size: 0.8rem;
      color: var(--text-muted);
      font-style: italic;
    }

    .label-qr {
      width: 20mm;
      min-width: 20mm;
      height: 22mm;
      display: grid;
      place-items: center;
      background: #fff;
      border-right: 1px solid rgba(15, 23, 42, 0.08);
      position: relative;
      padding: 0;
    }

    .label-qr img {
      width: 20mm;
      height: 20mm;
      object-fit: contain;
    }

    .label-qr .qr-fallback {
      position: absolute;
      inset: 0;
      display: none;
      font-size: 0.65rem;
      color: var(--danger);
      text-align: center;
      line-height: 22mm;
      background: repeating-linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0 6px, rgba(255, 255, 255, 0.5) 6px 12px);
    }

    .label-qr.qr-missing .qr-fallback {
      display: block;
    }

    .label-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.25;
      font-size: 0.78rem;
      width: 15mm;
      height: 22mm;
    }

    .label-text .code {
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .label-text .size {
      text-transform: uppercase;
      font-weight: 600;
      font-size: 0.78rem;
    }

    #printArea {
      display: none;
    }

    .print-guide ul {
      margin: 12px 0 0 16px;
      color: var(--text-muted);
      font-size: 0.9rem;
      padding-left: 16px;
    }

    .print-guide li + li {
      margin-top: 6px;
    }

    @media (max-width: 720px) {
      body {
        padding: 14px;
      }

      .hero-subtitle {
        font-size: 0.95rem;
      }

      .actions {
        flex-direction: column;
      }

      button {
        width: 100%;
        justify-content: center;
      }

      .label-page {
        width: 100%;
      }

      .hasize-card {
        flex-direction: column;
      }

      .hasize-qr {
        width: 100%;
        min-width: 0;
        border-left: none;
        border-top: 1px dashed rgba(15, 23, 42, 0.12);
        padding-left: 0;
        padding-top: 12px;
      }
    }

    @page {
      size: 105mm 22mm;
      margin: 0;
    }

    @media print {
      body {
        padding: 0;
        background: #fff;
      }

      main {
        display: none;
      }

      #printArea {
        display: block;
        margin: 0;
      }

      #printArea .label-page {
        box-shadow: none;
        border-radius: 0;
      }

      #printArea .label-page::after {
        display: none;
      }
    }
  </style>
</head>

<body>
  <main>
    <header class="page-header">
      <div class="topbar">
        <a class="brand" href="#" aria-label="Trang chủ">
          <span class="brand-dot" aria-hidden="true"></span>
          <span>Cô Mập Fashion</span>
        </a>
      </div>

      <div class="hero">
        <h1 class="hero-title" id="heroTitle">In tem</h1>
      </div>

      <div class="tab-nav" role="tablist">
        <button class="tab-button" id="tab-trigger-labels" type="button" role="tab" aria-controls="tab-labels" aria-selected="true"
          data-tab-target="labels">In tem</button>
        <button class="tab-button" id="tab-trigger-hasize" type="button" role="tab" aria-controls="tab-hasize" aria-selected="false"
          data-tab-target="hasize">Hạ size</button>
      </div>
    </header>

    <section class="tab-panel" data-tab-panel="labels" id="tab-labels">
      <section class="card">
        <h2>Nhập dòng hàng</h2>
        <div class="input-grid input-grid-vertical">
          <div>
            <label for="codeInput">Mã</label>
            <input type="text" id="codeInput" placeholder="Ví dụ: A123" autocomplete="off">
          </div>
          <div>
            <label for="sizeInput">Size</label>
            <select id="sizeInput">
              <option value="">Chọn size</option>
              <option value="M">M</option>
              <option value="L">L</option>
              <option value="XL">XL</option>
              <option value="XXL">XXL</option>
              <option value="XXXL">XXXL</option>
            </select>
          </div>
          <div>
            <label for="qtyInput">Số lượng</label>
            <input type="number" id="qtyInput" placeholder=">= 1" min="1">
          </div>
        </div>
        <div class="actions">
          <button class="btn-primary" id="addItemBtn">Thêm dòng</button>
          <button class="btn-outline" id="resetBtn" type="button">Reset</button>
        </div>
        <div id="formMessage" class="status-line info" role="status" hidden></div>
      </section>

      <section class="card">
        <div class="table-summary">
          <span id="itemCounter">0 dòng</span>
          <span id="qtyCounter">0 tem</span>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Mã</th>
                <th>Size</th>
                <th>Số lượng</th>
                <th>Ghi chú</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="itemsBody">
              <tr>
                <td colspan="6" class="empty-state">Chưa có dòng nào được thêm.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="actions single-action">
          <button class="btn-primary" id="sendWebhookBtn" disabled>Gửi</button>
        </div>
        <p id="sendHint" class="helper" hidden>Nhấn “Gửi” sau khi thêm đầy đủ dòng.</p>
        <div id="statusBox" class="status-line info" hidden></div>
      </section>

      <section class="card" id="layoutSection" hidden>
        <div class="layout-header">
          <div>
            <h2>Bản dàn tem</h2>
          </div>
          <button class="btn-outline" id="printBtn" type="button" style="display: none;" disabled>In</button>
        </div>
        <div id="layoutPreview" class="layout-grid">
          <div class="empty-state">Hãy nhấn “Gửi” để nhận tem.</div>
        </div>
      </section>
    </section>

    <section class="tab-panel" data-tab-panel="hasize" id="tab-hasize" hidden>
      <section class="card">
        <div class="layout-header">
          <div>
            <h2>Hạ size nhanh</h2>
          </div>
          <div class="hasize-actions">
            <button class="btn-outline" id="hasizePrintBtn" type="button" style="display: none;" disabled>In</button>
            <button class="btn-outline" id="hasizeClearBtn" type="button">Xóa danh sách</button>
          </div>
        </div>
        <div class="hasize-form">
          <div>
            <label for="hasizeInput">Serial / mã QR</label>
            <input type="text" id="hasizeInput" placeholder="Quét hoặc nhập serial" autocomplete="off">
          </div>
          <button class="btn-primary" id="hasizeSubmitBtn" type="button">Tạo QR hạ size</button>
        </div>
        <div id="hasizeStatus" class="status-line info" role="status">Quét sản phẩm cần hạ để nhận QR mới.</div>
      </section>
      <section class="card">
        <div class="table-summary">
          <span id="hasizeCounter">0 QR hạ size</span>
        </div>
        <div id="hasizeResults" class="hasize-grid">
          <div class="empty-state">Chưa có QR hạ size nào.</div>
        </div>
      </section>
    </section>

  </main>

  <!-- Vùng chỉ dùng cho in -->
  <section id="printArea" aria-hidden="true"></section>

  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.js"></script>
  <script>
    // Polyfill API for code below: QRCode.toDataURL(text, { width, margin, errorCorrectionLevel })
    // Uses https://github.com/kazuhikoarase/qrcode-generator (exposed as global `qrcode`).
    (() => {
      if (window.QRCode?.toDataURL) return;
      if (typeof window.qrcode !== 'function') return;

      window.QRCode = window.QRCode || {};
      window.QRCode.toDataURL = (text, options = {}) =>
        new Promise((resolve, reject) => {
          try {
            const value = String(text ?? '').trim();
            if (!value) return resolve('');

            const ecl = String(options.errorCorrectionLevel || 'M').toUpperCase();
            const width = Math.max(64, Number(options.width) || 160);
            const margin = Math.max(0, Math.min(12, Number(options.margin) || 2));

            const qr = window.qrcode(0, ecl);
            qr.addData(value);
            qr.make();

            const moduleCount = qr.getModuleCount();
            const cellSize = Math.max(1, Math.floor(width / (moduleCount + margin * 2)));
            resolve(qr.createDataURL(cellSize, margin));
          } catch (err) {
            reject(err);
          }
        });
    })();
  </script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const WEBHOOK_URL = 'https://n8n-hongnhung198198-u40833.vm.elestio.app/webhook/import-items';
      const HASIZE_WEBHOOK_URL = 'https://n8n-hongnhung198198-u40833.vm.elestio.app/webhook/hasize_hang';
      const CODE_REGEX = /^[ANT]\d{3}$/i;
      const ALLOWED_SIZES = ['M', 'L', 'XL', 'XXL', 'XXXL'];

      const state = {
        items: [],
        hashes: [],
        layoutReady: false,
        loading: false
      };

      const hasizeState = {
        entries: [],
        loading: false
      };
      let labelPrintHTML = '';

      const els = {
        code: document.getElementById('codeInput'),
        size: document.getElementById('sizeInput'),
        qty: document.getElementById('qtyInput'),
        addBtn: document.getElementById('addItemBtn'),
        resetBtn: document.getElementById('resetBtn'),
        formMessage: document.getElementById('formMessage'),
        itemCounter: document.getElementById('itemCounter'),
        qtyCounter: document.getElementById('qtyCounter'),
        body: document.getElementById('itemsBody'),
        sendBtn: document.getElementById('sendWebhookBtn'),
        printBtn: document.getElementById('printBtn'),
        statusBox: document.getElementById('statusBox'),
        sendHint: document.getElementById('sendHint'),
        heroTitle: document.getElementById('heroTitle'),
        heroSubtitle: document.getElementById('heroSubtitle'),
        layoutSection: document.getElementById('layoutSection'),
        layoutPreview: document.getElementById('layoutPreview'),
        printArea: document.getElementById('printArea'),
        tabButtons: document.querySelectorAll('[data-tab-target]'),
        tabPanels: document.querySelectorAll('[data-tab-panel]'),
        hasizeInput: document.getElementById('hasizeInput'),
        hasizeSubmit: document.getElementById('hasizeSubmitBtn'),
        hasizeClear: document.getElementById('hasizeClearBtn'),
        hasizePrintBtn: document.getElementById('hasizePrintBtn'),
        hasizeStatus: document.getElementById('hasizeStatus'),
        hasizeCounter: document.getElementById('hasizeCounter'),
        hasizeResults: document.getElementById('hasizeResults')
      };

      const hasizeSubmitLabel = els.hasizeSubmit?.textContent || 'Tạo QR hạ size';
      const DEFAULT_TAB = 'labels';
      const HERO_COPY = {
        labels: {
          title: 'In tem',
          subtitle: 'Tạo QR, in tem và hạ size nhanh — tập trung vào thao tác, tối giản và rõ ràng.'
        },
        hasize: {
          title: 'Hạ size',
          subtitle: 'Quét serial để tạo QR hạ size mới — nhanh, gọn và dễ kiểm soát.'
        }
      };

      const renderTable = () => {
        if (!state.items.length) {
          els.body.innerHTML = '<tr><td colspan="6" class="empty-state">Chưa có dòng nào được thêm.</td></tr>';
          renderTotals();
          return;
        }

        const rows = state.items.map((item, index) => {
          const note = item.error ? `<span style="color: var(--danger);">${item.error}</span>` : '—';
          return `
            <tr data-id="${item.id}" class="${item.error ? 'has-error' : ''}" style="animation-delay:${Math.min(index, 10) * 28}ms">
              <td>${index + 1}</td>
              <td>${item.code}</td>
              <td>${item.size}</td>
              <td>${item.qty}</td>
              <td>${note}</td>
              <td>
                <button class="btn-outline" data-remove="${item.id}" title="Xóa dòng">Xóa</button>
              </td>
            </tr>
          `;
        }).join('');
        els.body.innerHTML = rows;
        renderTotals();
      };

      const renderTotals = () => {
        els.itemCounter.textContent = `${state.items.length} dòng`;
        const qtyTotal = state.items.reduce((sum, i) => sum + i.qty, 0);
        els.qtyCounter.textContent = `${qtyTotal} tem`;
      };

      const flash = (element) => {
        if (!element) return;
        element.classList.remove('flash');
        void element.offsetWidth;
        element.classList.add('flash');
        window.setTimeout(() => element.classList.remove('flash'), 320);
      };

      const setHidden = (element, hidden) => {
        if (!element) return;
        if (hidden) element.setAttribute('hidden', '');
        else element.removeAttribute('hidden');
      };

      const setBusyStatus = (element, busy) => {
        if (!element) return;
        element.classList.toggle('is-busy', Boolean(busy));
        element.setAttribute('aria-busy', String(Boolean(busy)));
        if (busy) setHidden(element, false);
      };

      const setBusy = (element, busy) => {
        if (!element) return;
        if (busy) {
          element.setAttribute('data-busy', 'true');
          element.setAttribute('aria-busy', 'true');
        } else {
          element.removeAttribute('data-busy');
          element.removeAttribute('aria-busy');
        }
      };

      const buildSkeletonGrid = (count = 6) => {
        const safeCount = Math.max(1, Math.min(12, Number(count) || 6));
        return Array.from({ length: safeCount }, () => '<div class="skeleton-card" aria-hidden="true"></div>').join('');
      };

      const updateGlobalBusy = () => {
        document.body.classList.toggle('global-busy', state.loading || hasizeState.loading);
      };

      const setStatus = (type, message) => {
        if (!els.statusBox) return;
        const hasMessage = Boolean(message && String(message).trim());
        setHidden(els.statusBox, !hasMessage);
        if (!hasMessage) return;
        els.statusBox.textContent = message;
        els.statusBox.className = `status-line ${type}`;
        flash(els.statusBox);
      };

      const setFormMessage = (type, message) => {
        if (!els.formMessage) return;
        const hasMessage = Boolean(message && String(message).trim());
        setHidden(els.formMessage, !hasMessage);
        if (!hasMessage) return;
        els.formMessage.textContent = message;
        els.formMessage.className = `status-line ${type}`;
        flash(els.formMessage);
        if (type !== 'error') {
          window.setTimeout(() => {
            if (els.formMessage?.textContent === message) setHidden(els.formMessage, true);
          }, 900);
        }
      };

      const setHasizeStatus = (type, message) => {
        if (!els.hasizeStatus) return;
        els.hasizeStatus.textContent = message;
        els.hasizeStatus.className = `status-line ${type}`;
        flash(els.hasizeStatus);
      };

      const updateButtons = () => {
        const hasItems = state.items.length > 0;
        els.sendBtn.disabled = !hasItems || state.loading;
        els.sendBtn.classList.toggle('is-loading', state.loading);
        els.sendBtn.setAttribute('aria-busy', String(Boolean(state.loading)));
        setHidden(els.sendHint, !hasItems || state.loading);
        updateGlobalBusy();
      };

      const updateHasizePrintButton = () => {
        if (!els.hasizePrintBtn) return;
        if (!hasizeState.entries.length) {
          els.hasizePrintBtn.style.display = 'none';
          els.hasizePrintBtn.disabled = true;
          return;
        }
        els.hasizePrintBtn.style.display = '';
        els.hasizePrintBtn.disabled = hasizeState.loading;
      };

      const updateHasizeControls = () => {
        if (els.hasizeSubmit) {
          els.hasizeSubmit.disabled = hasizeState.loading;
          els.hasizeSubmit.textContent = hasizeState.loading ? 'Đang tạo...' : hasizeSubmitLabel;
          els.hasizeSubmit.classList.toggle('is-loading', hasizeState.loading);
          els.hasizeSubmit.setAttribute('aria-busy', String(Boolean(hasizeState.loading)));
        }
        if (els.hasizeClear) {
          const disableClear = hasizeState.loading || hasizeState.entries.length === 0;
          els.hasizeClear.disabled = disableClear;
        }
        updateHasizePrintButton();
        updateGlobalBusy();
      };

      const activateTab = (tabName = DEFAULT_TAB) => {
        const hero = HERO_COPY[tabName] || HERO_COPY[DEFAULT_TAB];
        if (els.heroTitle) els.heroTitle.textContent = hero.title;
        if (els.heroSubtitle) els.heroSubtitle.textContent = hero.subtitle;

        if (els.tabButtons?.forEach) {
          els.tabButtons.forEach((button) => {
            const isActive = button.dataset.tabTarget === tabName;
            button.setAttribute('aria-selected', String(isActive));
            button.classList.toggle('is-active', isActive);
          });
        }
        if (els.tabPanels?.forEach) {
          els.tabPanels.forEach((panel) => {
            const isActive = panel.dataset.tabPanel === tabName;
            if (isActive) {
              panel.removeAttribute('hidden');
            } else {
              panel.setAttribute('hidden', '');
            }
          });
        }
        if (tabName === 'hasize') {
          requestAnimationFrame(() => {
            els.hasizeInput?.focus();
          });
        }
      };

      const showPrintButton = () => {
        els.printBtn.style.display = '';
        els.printBtn.disabled = false;
      };

      const hidePrintButton = () => {
        els.printBtn.style.display = 'none';
        els.printBtn.disabled = true;
      };

      const resetAll = () => {
        state.items = [];
        state.hashes = [];
        state.layoutReady = false;
        state.loading = false;
        renderTable();
        els.layoutPreview.innerHTML = '<div class="empty-state">Hãy nhấn “Gửi” để nhận tem.</div>';
        els.printArea.innerHTML = '';
        labelPrintHTML = '';
        els.layoutSection?.setAttribute('hidden', '');
        hidePrintButton();
        resetForm();
        setStatus('', '');
        setFormMessage('', '');
        updateButtons();
      };

      const sanitizeCode = (value) => value.trim().toUpperCase();
      const sanitizeSize = (value) => value.trim().toUpperCase();
      const sanitizeQty = (value) => Number.parseInt(value, 10) || 0;
      const sanitizeSerial = (value) => value.trim().toUpperCase();

      const validateItem = ({ code, size, qty }) => {
        if (!code) return 'Vui lòng nhập mã.';
        if (!CODE_REGEX.test(code)) return 'Mã phải bắt đầu bằng A/N/T + 3 số (ví dụ A123).';
        if (!size) return 'Chọn size.';
        if (!ALLOWED_SIZES.includes(size)) return 'Size chỉ nhận M, L, XL, XXL, XXXL.';
        if (!Number.isInteger(qty) || qty < 1) return 'Số lượng phải là số nguyên ≥ 1.';
        return '';
      };

      const resetForm = () => {
        els.code.value = '';
        els.size.value = '';
        els.qty.value = '';
        els.code.focus();
      };

      const addItem = () => {
        const code = sanitizeCode(els.code.value);
        const size = sanitizeSize(els.size.value);
        const qty = sanitizeQty(els.qty.value);
        const validation = validateItem({ code, size, qty });

        if (validation) {
          setFormMessage('error', validation);
          return;
        }

        state.items.push({
          id: cryptoId(),
          code,
          size,
          qty,
          error: ''
        });

        setFormMessage('success', 'Đã thêm vào bảng tạm.');
        renderTable();
        updateButtons();
        resetForm();
      };

      const removeItem = (id) => {
        state.items = state.items.filter((item) => item.id !== id);
        renderTable();
        updateButtons();
      };

      const validateAllRows = () => {
        let hasError = false;
        state.items = state.items.map((item) => {
          const error = validateItem(item);
          if (error) hasError = true;
          return { ...item, error };
        });
        renderTable();
        return !hasError;
      };

      const QR_PRINT_MM = 20;
      const QR_RENDER_DPI = 300;
      const QR_RENDER_PX = Math.max(160, Math.round((QR_PRINT_MM / 25.4) * QR_RENDER_DPI));
      const qrDataUrlCache = new Map();

      const getQrDataUrl = async (value) => {
        const normalized = (value || '').trim();
        if (!normalized) return '';
        if (qrDataUrlCache.has(normalized)) return qrDataUrlCache.get(normalized);

        if (!window.QRCode?.toDataURL) {
          throw new Error('Thiếu thư viện tạo QR (QRCode.toDataURL).');
        }

        const promise = window.QRCode.toDataURL(normalized, {
          errorCorrectionLevel: 'M',
          width: QR_RENDER_PX,
          margin: 2,
          color: { dark: '#000000', light: '#ffffff' }
        });

        qrDataUrlCache.set(normalized, promise);
        return promise;
      };

      const cryptoId = () => {
        if (window.crypto?.randomUUID) return window.crypto.randomUUID();
        return `id-${Date.now()}-${Math.random().toString(16).slice(2)}`;
      };

      const formatDateTime = (value) => {
        if (!value) return '—';
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return value;
        return date.toLocaleString('vi-VN');
      };

      const normalizeHasizeItem = (item, fallbackSerial) => {
        if (!item && !fallbackSerial) return null;
        const serial = sanitizeSerial(item?.serial || fallbackSerial || '');
        if (!serial) return null;
        return {
          id: item?.id || cryptoId(),
          sku: sanitizeCode(item?.sku || ''),
          size: sanitizeSize(item?.size || ''),
          serial,
          status: item?.status || '',
          orderCode: item?.order_code || '',
          createdAt: item?.created_at || new Date().toISOString(),
          hash: item?.hash || ''
        };
      };

      const getHasizeQrValue = (entry) => entry.serial || [entry.sku, entry.size, entry.hash].filter(Boolean).join('-');

      const buildHasizeCardHtml = (entry, options = {}) => {
        const { lazy = true, index = 0 } = options;
        const qrValue = getHasizeQrValue(entry);
        const sku = entry.sku || '—';
        const sizeText = entry.size || '—';
        const metaParts = [`SKU: ${sku}`, `Size: ${sizeText}`];
        const metaHtml = metaParts.map((text) => `<span>${text}</span>`).join('');
        const loadingAttr = lazy ? ' loading="lazy"' : '';
        return `
            <article class="hasize-card" style="animation-delay:${Math.min(index, 10) * 36}ms">
              <div class="hasize-details">
                <div class="hasize-meta">${metaHtml}</div>
              </div>
              <div class="hasize-qr" data-qr="${qrValue}">
                <img alt="QR hạ size" ${loadingAttr}>
                <span>Quét để hạ size</span>
              </div>
            </article>
          `;
      };

      const upsertHasizeEntries = (entries) => {
        entries.forEach((entry) => {
          const index = hasizeState.entries.findIndex((item) => item.serial === entry.serial);
          if (index >= 0) {
            hasizeState.entries[index] = entry;
          } else {
            hasizeState.entries.unshift(entry);
          }
        });
      };

      const renderHasizeResults = () => {
        if (!els.hasizeResults) return;
        if (els.hasizeCounter) {
          els.hasizeCounter.textContent = `${hasizeState.entries.length} QR hạ size`;
        }
        if (!hasizeState.entries.length) {
          els.hasizeResults.innerHTML = '<div class="empty-state">Chưa có QR hạ size nào.</div>';
          updateHasizePrintButton();
          return;
        }

        const cards = hasizeState.entries.map((entry, index) => buildHasizeCardHtml(entry, { index })).join('');

        els.hasizeResults.innerHTML = cards;
        renderQrCodes(els.hasizeResults);
        updateHasizePrintButton();
      };

      const clearHasizeResults = () => {
        hasizeState.entries = [];
        renderHasizeResults();
        setHasizeStatus('info', 'Đã xóa danh sách QR hạ size.');
        updateHasizeControls();
      };

      const chunkLabels = (labels) => {
        const pages = [];
        for (let i = 0; i < labels.length; i += 3) {
          pages.push(labels.slice(i, i + 3));
        }
        if (pages.length) {
          const lastPage = pages[pages.length - 1];
          while (lastPage.length < 3) {
            lastPage.push({ blank: true });
          }
        }
        return pages;
      };

      const buildHasizePrintLayout = () => {
        if (!hasizeState.entries.length) return '';
        const labels = hasizeState.entries.map((entry) => ({
          code: entry.sku || '—',
          size: entry.size || '',
          value: getHasizeQrValue(entry)
        }));
        const pages = chunkLabels(labels);
        if (!pages.length) return '';
        return pages.map((labelsOnPage, pageIndex) => {
          const cells = labelsOnPage.map((label) => {
            if (label.blank) {
              return '<div class="label-cell is-blank"><span>Tem trống</span></div>';
            }
            const sku = label.code || '—';
            const sizeText = label.size || '';
            const qrValue = label.value || '';
            return `
              <div class="label-cell">
                <div class="label-qr" data-qr="${qrValue}">
                  <img alt="QR ${qrValue}">
                  <span class="qr-fallback">QR lỗi</span>
                </div>
                <div class="label-text">
                  <span class="code">${sku}</span>
                  <span class="size">${sizeText}</span>
                </div>
              </div>
            `;
          }).join('');
          return `<div class="label-page" data-page="Trang ${pageIndex + 1}">${cells}</div>`;
        }).join('');
      };

      const restoreLabelPrintArea = () => {
        if (state.layoutReady && labelPrintHTML) {
          els.printArea.innerHTML = labelPrintHTML;
          renderQrCodes(els.printArea);
          return;
        }
        if (!state.layoutReady) {
          els.printArea.innerHTML = '';
        }
      };

      const handleHasizePrint = () => {
        if (!hasizeState.entries.length) {
          setHasizeStatus('error', 'Chưa có QR hạ size để in.');
          return;
        }

        const layout = buildHasizePrintLayout();
        if (!layout) {
          setHasizeStatus('error', 'Chưa có QR hạ size để in.');
          return;
        }

        setHasizeStatus('info', 'Đang mở hộp thoại in QR hạ size...');
        els.printArea.innerHTML = layout;
        let cleanedUp = false;
        renderQrCodes(els.printArea);
        const cleanup = () => {
          if (cleanedUp) return;
          cleanedUp = true;
          restoreLabelPrintArea();
          setHasizeStatus('success', 'Đã chuẩn bị xong bản in QR hạ size.');
          window.removeEventListener('afterprint', cleanup);
          window.removeEventListener('focus', cleanup);
        };
        window.addEventListener('afterprint', cleanup);
        window.addEventListener('focus', cleanup);
        window.print();
      };

      const handleHasizeSubmit = async () => {
        const serial = sanitizeSerial(els.hasizeInput?.value || '');
        if (!serial) {
          setHasizeStatus('error', 'Vui lòng quét hoặc nhập serial.');
          els.hasizeInput?.focus();
          return;
        }

        hasizeState.loading = true;
        updateHasizeControls();
        setHasizeStatus('info', 'Đang tạo QR hạ size...');
        setBusyStatus(els.hasizeStatus, true);
        setBusy(els.hasizeResults, true);

        try {
          const response = await fetch(HASIZE_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ serial })
          });

          if (!response.ok) {
            const text = await response.text();
            throw new Error(text || `Webhook trả về mã lỗi ${response.status}`);
          }

          const payload = await response.json();
          const list = Array.isArray(payload) ? payload : [payload];
          const normalized = list.map((item) => normalizeHasizeItem(item, serial)).filter(Boolean);

          if (!normalized.length) {
            throw new Error('Webhook không trả về thông tin serial hợp lệ.');
          }

          upsertHasizeEntries(normalized);
          renderHasizeResults();
          setHasizeStatus('success', `Đã tạo ${normalized.length} QR hạ size.`);
          if (els.hasizeInput) {
            els.hasizeInput.value = '';
            els.hasizeInput.focus();
          }
        } catch (error) {
          console.error(error);
          setHasizeStatus('error', error.message || 'Không tạo được QR hạ size.');
        } finally {
          hasizeState.loading = false;
          updateHasizeControls();
          setBusyStatus(els.hasizeStatus, false);
          setBusy(els.hasizeResults, false);
        }
      };

      const extractSerials = (payload) => {
        if (!payload) return [];
        const strings = [];
        const collect = (value) => {
          if (Array.isArray(value)) {
            value.forEach((entry) => {
              if (typeof entry === 'string') {
                strings.push(entry);
              } else if (entry && typeof entry === 'object') {
                collect(entry.serials);
                collect(entry.hashes);
              }
            });
          } else if (typeof value === 'string') {
            strings.push(value);
          } else if (value && typeof value === 'object') {
            collect(value.serials);
            collect(value.hashes);
          }
        };
        collect(payload);
        return strings.filter(Boolean);
      };

      const sendWebhook = async () => {
        if (!validateAllRows()) {
          setStatus('error', 'Có dòng chưa hợp lệ, vui lòng kiểm tra lại.');
          return;
        }
        const payloadItems = state.items.map(({ code, size, qty }) => ({ code, size, qty }));
        const hadLayoutBeforeSend = state.layoutReady;
        state.layoutReady = false;
        hidePrintButton();
        state.loading = true;
        updateButtons();
        setStatus('info', 'Đang gửi webhook...');
        setBusyStatus(els.statusBox, true);
        els.layoutSection?.removeAttribute('hidden');
        els.layoutPreview.innerHTML = buildSkeletonGrid(6);
        try {
          const res = await fetch(WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ items: payloadItems })
          });

          if (!res.ok) {
            const text = await res.text();
            throw new Error(text || `Webhook trả về mã lỗi ${res.status}`);
          }

          const data = await res.json();
          const hashes = extractSerials(data);
          if (!hashes.length) {
            throw new Error('Webhook không trả về danh sách serials/hashes hợp lệ.');
          }

          state.hashes = hashes;
          buildLayout();
        } catch (error) {
          console.error(error);
          setStatus('error', error.message || 'Gửi webhook thất bại.');
          if (hadLayoutBeforeSend && state.hashes.length) {
            state.layoutReady = true;
            showPrintButton();
            els.layoutSection?.removeAttribute('hidden');
          } else {
            els.layoutSection?.setAttribute('hidden', '');
          }
        } finally {
          state.loading = false;
          updateButtons();
          setBusyStatus(els.statusBox, false);
        }
      };

      const parseHashes = () => {
        const normalized = [];
        state.hashes.forEach((entry) => {
          if (typeof entry !== 'string') return;
          const parts = entry.split('-');
          const code = (parts.shift() || '').toUpperCase();
          const size = (parts.shift() || '').toUpperCase();
          const hash = (parts.join('-') || '').toUpperCase();
          if (!code || !size) return;
          const qrValue = hash ? `${code}-${size}-${hash}` : `${code}-${size}`;
          normalized.push({ code, size, hash, value: qrValue });
        });
        return normalized;
      };

      const renderPages = (container, pages) => {
        if (!pages.length) {
          container.innerHTML = '<div class="empty-state">Chưa có bản dàn tem.</div>';
          return;
        }

        const pageHtml = pages.map((labels, pageIndex) => {
          const cells = labels.map((label) => {
            if (label.blank) {
              return '<div class="label-cell is-blank"><span>Tem trống</span></div>';
            }
            return `
              <div class="label-cell">
                <div class="label-qr" data-qr="${label.value}">
                  <img alt="QR ${label.value}">
                  <span class="qr-fallback">QR lỗi</span>
                </div>
                <div class="label-text">
                  <span class="code">${label.code}</span>
                  <span class="size">${label.size}</span>
                </div>
              </div>
            `;
          }).join('');

          return `<div class="label-page" data-page="Trang ${pageIndex + 1}">${cells}</div>`;
        }).join('');

        container.innerHTML = pageHtml;
        renderQrCodes(container);
        if (container === els.printArea) {
          labelPrintHTML = container.innerHTML;
        }
      };

      const renderQrCodes = (container) => {
        if (!container) return;
        const targets = container.querySelectorAll('.label-qr[data-qr], .hasize-qr[data-qr]');
        targets.forEach(async (node) => {
          const value = node.dataset.qr;
          const img = node.querySelector('img');
          if (!value || !img) return;
          node.classList.remove('qr-missing');
          img.alt = `QR ${value}`;
          try {
            img.src = await getQrDataUrl(value);
            node.classList.remove('qr-missing');
          } catch (error) {
            console.error(error);
            node.classList.add('qr-missing');
            img.removeAttribute('src');
          }
        });
      };

      const buildLayout = () => {
        if (!state.hashes.length) {
          setStatus('error', 'Chưa có dữ liệu hashes. Hãy nhấn “Gửi” trước.');
          return;
        }

        els.layoutSection?.removeAttribute('hidden');
        const labels = parseHashes();
        const pages = chunkLabels(labels);
        renderPages(els.layoutPreview, pages);
        renderPages(els.printArea, pages);
        state.layoutReady = true;
        showPrintButton();
        setStatus('success', `Đã dàn ${labels.length} tem thành ${pages.length} trang.`);
      };

      const handlePrint = () => {
        if (!state.layoutReady) {
          setStatus('error', 'Chưa có bản dàn tem để in.');
          return;
        }
        window.print();
      };

      els.addBtn.addEventListener('click', addItem);
      els.resetBtn.addEventListener('click', resetAll);
      els.sendBtn.addEventListener('click', sendWebhook);
      els.printBtn.addEventListener('click', handlePrint);

      els.body.addEventListener('click', (event) => {
        const button = event.target.closest('button[data-remove]');
        if (button) {
          removeItem(button.getAttribute('data-remove'));
        }
      });

      ['code', 'size', 'qty'].forEach((key) => {
        const input = els[key];
        input.addEventListener('keydown', (event) => {
          if (event.key === 'Enter') {
            event.preventDefault();
            addItem();
          }
        });
      });

      els.hasizeSubmit?.addEventListener('click', handleHasizeSubmit);
      els.hasizeInput?.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          event.preventDefault();
          handleHasizeSubmit();
        }
      });
      els.hasizeClear?.addEventListener('click', clearHasizeResults);
      els.hasizePrintBtn?.addEventListener('click', handleHasizePrint);

      if (els.tabButtons?.forEach) {
        els.tabButtons.forEach((button) => {
          button.addEventListener('click', () => {
            activateTab(button.dataset.tabTarget);
          });
        });
      }

      activateTab(DEFAULT_TAB);
      hidePrintButton();
      updateButtons();
      renderHasizeResults();
      updateHasizeControls();
    });
  </script>
</body>

</html>
